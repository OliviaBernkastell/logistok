<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOGISTOK - Sistem Pengajuan Barang</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-dark: #006D77;
            --primary-light: #83C5BE;
            --background: #EDF6F9;
            --accent-light: #FFDDD2;
            --accent-dark: #E29578;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, #F8FAFC 100%);
            color: var(--primary-dark);
            padding-top: 70px;
            margin: 0;
        }
        .btn-primary {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
            color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(131, 197, 190, 0.4);
        }
        .btn-primary:active, .btn-primary:focus {
            background: var(--primary-dark) !important;
            border-color: var(--primary-dark) !important;
            color: white !important;
            box-shadow: 0 0 0 0.25rem rgba(131, 197, 190, 0.25) !important;
        }
        .btn-outline-primary {
            color: var(--primary-dark);
            border-color: var(--primary-light);
            transition: all 0.3s ease;
        }
        .btn-outline-primary:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }
        .btn-export {
            background: var(--primary-light);
            border-color: var(--primary-light);
            color: var(--primary-dark);
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-export:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 109, 119, 0.4);
        }
        .btn-danger {
            background: var(--accent-dark);
            border-color: var(--accent-dark);
        }
        .btn-danger:hover {
            background: #d4a893;
        }
        .form-control {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 0.25rem rgba(131, 197, 190, 0.25);
            outline: none;
        }
        .navbar {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            box-shadow: 0 4px 12px rgba(0, 109, 119, 0.15);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            padding: 0.75rem 0;
        }
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: white !important;
        }
        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            padding: 0.5rem 1rem !important;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-light) !important;
        }
        .nav-link.active {
            background: linear-gradient(135deg, var(--accent-light), var(--accent-dark));
            color: var(--primary-dark) !important;
            font-weight: 600;
        }
        .header-section {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            padding: 80px 0 140px;
            margin-bottom: 0;
        }
        .header-title {
            font-size: 3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
        }
        .main-container {
            position: relative;
            z-index: 10;
            margin-top: -80px;
            padding-bottom: 2rem;
        }
        .form-card, .content-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 109, 119, 0.1);
        }
        .form-header {
            background: linear-gradient(135deg, var(--background) 0%, white 100%);
            padding: 2.5rem 2rem;
            border-bottom: 1px solid rgba(131, 197, 190, 0.1);
            text-align: center;
            border-radius: 24px 24px 0 0;
        }
        .form-section {
            padding: 1.5rem 2rem;
        }
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(131, 197, 190, 0.1);
        }
        .section-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0;
        }
        .custom-dropdown {
            position: relative;
        }
        .custom-dropdown .form-control {
            cursor: text;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23006D77' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 12px;
            padding-right: 2.5rem;
        }
        .custom-dropdown.show .form-control {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 0.25rem rgba(131, 197, 190, 0.25);
        }
        .custom-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            display: none;
            min-width: 100%;
            padding: 0.5rem 0;
            margin: 0.25rem 0 0;
            background-color: white;
            border: 2px solid var(--primary-light);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 109, 119, 0.2);
            max-height: 300px;
            overflow-y: auto;
        }
        .custom-dropdown.show .custom-dropdown-menu {
            display: block;
        }
        .custom-dropdown-menu::-webkit-scrollbar {
            width: 8px;
        }
        .custom-dropdown-menu::-webkit-scrollbar-track {
            background: var(--background);
            border-radius: 10px;
        }
        .custom-dropdown-menu::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }
        .custom-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            color: var(--primary-dark);
            margin: 0.125rem 0.5rem;
            border-radius: 8px;
        }
        .custom-dropdown-item:hover, .custom-dropdown-item.active {
            background-color: var(--primary-light);
            color: white;
        }
        .custom-dropdown-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        .dropdown-item-icon {
            margin-right: 0.75rem;
            color: var(--primary-light);
            width: 20px;
            flex-shrink: 0;
            transition: color 0.15s ease;
        }
        .custom-dropdown-item:hover .dropdown-item-icon {
            color: white;
        }
        .dropdown-item-text {
            flex: 1;
            font-weight: 500;
        }
        .dropdown-item-text .highlight {
            background: var(--accent-light);
            padding: 0.1rem 0.3rem;
            border-radius: 4px;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .custom-dropdown-item:hover .highlight {
            background: white;
            color: var(--primary-dark);
        }
        .stock-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: auto;
        }
        .stock-badge.high {
            background: rgba(131, 197, 190, 0.2);
            color: var(--primary-dark);
            border: 1px solid var(--primary-light);
        }
        .stock-badge.medium {
            background: var(--accent-light);
            color: var(--accent-dark);
            border: 1px solid var(--accent-dark);
        }
        .stock-badge.low {
            background: rgba(226, 149, 120, 0.3);
            color: var(--accent-dark);
            border: 1px solid var(--accent-dark);
        }
        .custom-dropdown-item:hover .stock-badge {
            background: white;
        }
        .no-results {
            padding: 1rem;
            text-align: center;
            color: var(--primary-light);
        }
        .skeleton {
            background: linear-gradient(90deg, var(--background) 25%, #e0e7ef 50%, var(--background) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 8px;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .skeleton-text {
            height: 20px;
            margin-bottom: 10px;
        }
        .skeleton-input {
            height: 50px;
            margin-bottom: 20px;
        }
        .skeleton-button {
            height: 45px;
            width: 150px;
        }
        .skeleton-row {
            height: 60px;
            margin-bottom: 8px;
        }
        .typing-indicator {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            color: var(--primary-light);
            font-size: 0.9rem;
        }
        .custom-dropdown.typing .typing-indicator {
            display: block;
        }
        .item-card {
            background: white;
            border: 2px solid var(--primary-light);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }
        .item-card:hover {
            box-shadow: 0 4px 12px rgba(0, 109, 119, 0.15);
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }
        .item-name {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1.05rem;
        }
        .item-quantity {
            color: var(--primary-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .item-keterangan {
            background: var(--background);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--primary-dark);
            margin-top: 0.5rem;
            font-style: italic;
        }
        .remove-btn {
            background: var(--accent-dark);
            color: white;
            border: none;
            padding: 0.4rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .remove-btn:hover {
            background: #d4a893;
            transform: scale(1.05);
        }
        .content-card {
            padding: 2rem;
        }
        .table-responsive {
            border-radius: 12px;
            overflow-x: auto;
            overflow-y: visible;
            position: relative;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        .table-responsive::before,
        .table-responsive::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 20px;
            pointer-events: none;
            z-index: 10;
            transition: opacity 0.3s ease;
        }
        .table-responsive::before {
            left: 0;
            background: linear-gradient(to right, rgba(255,255,255,0.95), transparent);
            opacity: 0;
        }
        .table-responsive::after {
            right: 0;
            background: linear-gradient(to left, rgba(255,255,255,0.95), transparent);
            opacity: 1;
        }
        .table-responsive.scrolled-left::before {
            opacity: 1;
        }
        .table-responsive.scrolled-right::after {
            opacity: 0;
        }
        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }
        .table-responsive::-webkit-scrollbar-track {
            background: var(--background);
            border-radius: 10px;
        }
        .table-responsive::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }
        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        .scroll-hint {
            display: none;
            text-align: center;
            padding: 0.5rem;
            background: var(--accent-light);
            color: var(--primary-dark);
            font-size: 0.85rem;
            border-radius: 8px 8px 0 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        @media (max-width: 768px) {
            .scroll-hint {
                display: block;
            }
                #cetakPage .action-buttons {
        top: 100px;
        right: 10px;
        flex-direction: column;
        gap: 8px;
    }
    #cetakPage .action-buttons .btn {
        width: 140px;
    }
        }
        .table {
            margin-bottom: 0;
        }
        .table thead th {
            background: var(--primary-dark);
            color: white;
            font-weight: 600;
            border: none;
            padding: 1rem;
            text-align: left;
            white-space: nowrap;
        }
        .table tbody td {
            padding: 1rem;
            vertical-align: middle;
            border-bottom: 1px solid var(--background);
        }
        .table tbody tr:hover {
            background: var(--background);
            transition: all 0.2s ease;
        }
        .badge-timestamp {
            background: var(--primary-light);
            color: var(--primary-dark);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .badge-quantity {
            background: var(--accent-light);
            color: var(--accent-dark);
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .btn-tarik {
            background: var(--accent-dark);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .btn-tarik:hover {
            background: #d4a893;
            transform: scale(1.05);
        }
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        .info-card {
            background: linear-gradient(135deg, var(--accent-light), rgba(255, 221, 210, 0.7));
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 2px solid var(--accent-dark);
        }
        .stats-card {
            background: linear-gradient(135deg, var(--accent-light), rgba(255, 221, 210, 0.7));
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 2px solid var(--accent-dark);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--primary-light);
            font-weight: 500;
        }
        .search-filter-bar {
            background: var(--background);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 2px solid var(--primary-light);
        }
        .search-box {
            position: relative;
        }
        .search-box input {
            padding-left: 2.5rem;
        }
        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-light);
        }
        .filter-select {
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            background: white;
            color: var(--primary-dark);
            font-weight: 500;
        }
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--primary-light);
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        .pagination {
            margin-top: 2rem;
        }
        .pagination .page-link {
            color: var(--primary-dark);
            border: 2px solid var(--primary-light);
            margin: 0 0.25rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .pagination .page-link:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
            color: white;
        }
        .pagination .page-item.active .page-link {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            color: white;
        }
        .modal-content {
            border-radius: 16px;
            border: none;
        }
        .modal-header {
            border-radius: 16px 16px 0 0;
            border: none;
        }
        .modal-body {
            padding: 2rem;
        }
        .modal-footer {
            border: none;
            padding: 1rem 2rem 2rem;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--background);
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            font-weight: 600;
            color: var(--primary-dark);
        }
        .detail-value {
            color: var(--primary-light);
        }
        /* =============== CETAK DOKUMEN STYLES =============== */
        #cetakPage .input-section {
            background-color: #f8f9fa;
            border: 2px solid var(--primary-dark);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            max-width: 900px;
        }
        #cetakPage .input-section h3 {
            color: var(--primary-dark);
            margin-top: 0;
        }
        #cetakPage .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        #cetakPage .form-group {
            flex: 1;
            min-width: 200px;
        }
        #cetakPage .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #cetakPage .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #cetakPage .btn-generate {
            background-color: var(--primary-dark);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        #cetakPage .btn-generate:hover {
            background-color: #005055;
        }
        #cetakPage .loading, #cetakPage .error-message {
            margin-top: 10px;
            display: none;
        }
        #cetakPage .loading {
            color: var(--primary-dark);
        }
        #cetakPage .error-message {
            color: #dc3545;
        }
        #cetakPage .header-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        #cetakPage .header-table td {
            border: none;
            padding: 5px;
            vertical-align: middle;
        }
        #cetakPage .logo-column {
            width: 340px;
            vertical-align: middle;
        }
        #cetakPage .spacer-column {
            width: auto;
            min-width: 200px;
        }
        #cetakPage .info-column {
            width: 250px;
            vertical-align: middle;
        }
        #cetakPage .logo-container {
            width: 320px !important;
            height: 60px !important;
            max-width: 320px !important;
            max-height: 60px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
        }
        #cetakPage .logo-container img {
            width: 320px !important;
            height: 60px !important;
            max-width: 320px !important;
            max-height: 60px !important;
            object-fit: contain;
        }
        #cetakPage .logo-fallback {
            width: 320px !important;
            height: 60px !important;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: #666;
            text-align: center;
            background-color: #f9f9f9;
        }
        #cetakPage .info-table {
            width: 100%;
            border-collapse: collapse;
        }
        #cetakPage .info-table td {
            border: none;
            padding: 2px;
            font-size: 11pt;
        }
        #cetakPage .info-label {
            text-align: left;
            width: 100px;
        }
        #cetakPage .info-separator {
            text-align: center;
            width: 20px;
        }
        #cetakPage .info-value {
            text-align: left;
            width: 130px;
        }
        #cetakPage .document-title {
            text-align: center !important;
            font-weight: bold !important;
            font-size: 12pt;
            text-decoration: underline !important;
            margin: 20px 0;
        }
        #cetakPage .work-unit {
            text-align: left;
            margin-bottom: 20px;
        }
        #cetakPage .main-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        #cetakPage .main-table th {
            border: 1px solid black;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            font-size: 11pt;
            font-weight: normal;
        }
        #cetakPage .main-table .data-row td {
            border: 1px solid black;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            font-size: 11pt;
        }
        #cetakPage .main-table .name-column {
            text-align: left;
            width: 200px;
        }
        #cetakPage .main-table .no-column {
            width: 40px;
        }
        #cetakPage .main-table .qty-column {
            width: 60px;
        }
        #cetakPage .main-table .unit-column {
            width: 80px;
        }
        #cetakPage .main-table .note-column {
            width: 120px;
        }
        #cetakPage .main-table .signature-row td {
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-top: none;
            border-bottom: none;
            padding: 10px;
            vertical-align: top;
            font-size: 11pt;
        }
        #cetakPage .main-table .pengeluaran-title-row td {
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-top: 1px solid black;
            border-bottom: 1px solid black;
            padding: 8px;
            text-align: center;
            font-weight: normal;
            background-color: white;
        }
        #cetakPage .main-table .pengeluaran-content-row td {
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-top: none;
            border-bottom: 1px solid black;
            padding: 15px;
            text-align: center;
            vertical-align: top;
            font-size: 11pt;
        }
        #cetakPage .note-kasubbag {
            margin-top: 10px;
            color: red;
            font-size: 10pt;
        }
        #cetakPage .action-buttons {
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 1000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    border-radius: 8px;
    padding: 8px;
    background: white;
}
        #cetakPage .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
            margin-bottom: 5px;
        }
        #cetakPage .btn:hover {
            background-color: #0056b3;
        }
        #cetakPage .btn-success {
            background-color: #28a745;
        }
        #cetakPage .btn-success:hover {
            background-color: #218838;
        }
        #cetakPage .btn-info {
            background-color: #17a2b8;
        }
        #cetakPage .btn-info:hover {
            background-color: #138496;
        }
        @media print {
            #cetakPage .action-buttons, #cetakPage .input-section {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 109, 119, 0.95); display: none; align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center; color: white;">
            <div style="width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
            <style>@keyframes spin { to { transform: rotate(360deg); }}</style>
            <h4 id="loadingText">Memproses...</h4>
        </div>
    </div>
    <div class="toast-container" id="toastContainer" style="position: fixed; top: 100px; right: 20px; z-index: 1055;"></div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-dark), var(--primary-light)); color: white;">
                    <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Login Rekap Pengeluaran</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                    </form>
                    <div class="mt-3" style="font-size: 0.85rem; color: var(--primary-light);">
                        <strong>Demo accounts:</strong><br>
                        admin / admin123<br>
                        staff / staff123
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Tarik -->
    <div class="modal fade" id="tarikModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--accent-dark), var(--accent-light)); color: white;">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Konfirmasi Penarikan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Yakin ingin menarik pengajuan ini?</p>
                    <div style="background: var(--background); padding: 1rem; border-radius: 12px;">
                        <div class="detail-row">
                            <span class="detail-label">Barang:</span>
                            <span class="detail-value" id="modalNamaBarang">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Jumlah:</span>
                            <span class="detail-value" id="modalJumlah">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pegawai:</span>
                            <span class="detail-value" id="modalNamaPegawai">-</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmTarikBtn">Ya, Tarik</button>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" style="cursor: pointer;" onclick="showPage('form')">
                <i class="fas fa-boxes me-2" style="font-size: 1.8rem;"></i>
                <div>LOGISTOK</div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" style="background: rgba(255,255,255,0.2); border: none;">
                <i class="fas fa-bars" style="color: white;"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" id="navForm" onclick="showPage('form')">
                            <i class="fas fa-file-alt me-1"></i>Form Pengajuan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="navRiwayat" onclick="showPage('riwayat')">
                            <i class="fas fa-history me-1"></i>Riwayat Pengajuan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="navRekap" onclick="showPageWithAuth('rekap')">
                            <i class="fas fa-chart-bar me-1"></i>Rekap Pengeluaran
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="navCetak" onclick="showPage('cetak')">
                            <i class="fas fa-print me-1"></i>Cetak Dokumen
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- FORM PENGAJUAN PAGE -->
    <div id="formPage" class="page-section active">
        <section class="header-section">
            <div class="container text-center">
                <div style="font-size: 4rem; color: white; margin-bottom: 2rem;">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h1 class="header-title">LOGISTOK</h1>
                <p style="font-size: 1.25rem; color: rgba(255, 255, 255, 0.9);">Sistem Pengajuan Barang</p>
            </div>
        </section>
        <div class="main-container">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card form-card border-0">
                            <div class="form-header">
                                <h2 class="h3 mb-2" style="color: var(--primary-dark);">
                                    <i class="fas fa-file-alt me-2"></i>Form Pengajuan Barang
                                </h2>
                                <p class="mb-0" style="color: var(--primary-light);">Data dimuat langsung dari Database</p>
                            </div>
                            <div id="formLoadingSkeleton" class="p-4">
                                <div class="skeleton skeleton-text" style="width: 30%;"></div>
                                <div class="skeleton skeleton-input"></div>
                                <div class="skeleton skeleton-text" style="width: 40%; margin-top: 2rem;"></div>
                                <div class="skeleton skeleton-input"></div>
                                <div class="row">
                                    <div class="col-6"><div class="skeleton skeleton-input"></div></div>
                                    <div class="col-6"><div class="skeleton skeleton-input"></div></div>
                                </div>
                                <div class="skeleton skeleton-input" style="height: 100px;"></div>
                            </div>
                            <form id="formPengambilanBarang" style="display: none;">
                                <div class="form-section">
                                    <div class="section-header">
                                        <div class="section-icon"><i class="fas fa-user"></i></div>
                                        <h3 class="section-title">Informasi Pegawai</h3>
                                    </div>
                                    <div class="mb-4">
                                        <label for="namaPegawai" class="form-label fw-medium">
                                            Nama Pegawai <span style="color: var(--accent-dark);">*</span>
                                        </label>
                                        <div class="custom-dropdown" id="pegawaiDropdown">
                                            <input type="text" class="form-control" id="namaPegawai" placeholder="Ketik untuk mencari pegawai..." autocomplete="off">
                                            <span class="typing-indicator"><i class="fas fa-search"></i></span>
                                            <div class="custom-dropdown-menu" id="pegawaiMenu"></div>
                                        </div>
                                        <small style="color: var(--primary-light);">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <span id="userCount">0</span> pegawai tersedia
                                        </small>
                                    </div>
                                </div>
                                <div class="form-section">
                                    <div class="section-header">
                                        <div class="section-icon"><i class="fas fa-box"></i></div>
                                        <h3 class="section-title">Detail Barang</h3>
                                    </div>
                                    <div class="mb-3">
                                        <label for="namaBarang" class="form-label fw-medium">
                                            Nama Barang <span style="color: var(--accent-dark);">*</span>
                                        </label>
                                        <div class="custom-dropdown" id="barangDropdown">
                                            <input type="text" class="form-control" id="namaBarang" placeholder="Ketik untuk mencari barang..." autocomplete="off">
                                            <span class="typing-indicator"><i class="fas fa-search"></i></span>
                                            <div class="custom-dropdown-menu" id="barangMenu"></div>
                                        </div>
                                        <small style="color: var(--primary-light);">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <span id="barangCount">0</span> item tersedia
                                        </small>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="jumlah" class="form-label fw-medium">Jumlah <span style="color: var(--accent-dark);">*</span></label>
                                            <input type="number" class="form-control" id="jumlah" placeholder="0" min="1">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="satuan" class="form-label fw-medium">Satuan</label>
                                            <input type="text" class="form-control" id="satuan" placeholder="Auto" readonly style="background-color: var(--background);">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="keterangan" class="form-label fw-medium">
                                            Keterangan Penggunaan <span style="color: var(--accent-dark);">*</span>
                                        </label>
                                        <textarea class="form-control" id="keterangan" rows="3" placeholder="Contoh: Untuk keperluan printing dokumen laporan bulanan..." style="resize: vertical;"></textarea>
                                        <small style="color: var(--primary-light);">Jelaskan untuk apa barang ini akan digunakan</small>
                                    </div>
                                    <div class="text-center">
                                        <button type="button" class="btn btn-outline-primary btn-lg px-5" id="addItemBtn">
                                            <i class="fas fa-plus me-2"></i>Tambah ke Daftar
                                        </button>
                                    </div>
                                    <div id="itemsList" style="display: none; margin-top: 2rem;">
                                        <div style="background: var(--background); border-radius: 12px; padding: 1.5rem; border: 2px solid var(--primary-light);">
                                            <h6 style="color: var(--primary-dark); margin-bottom: 1.5rem; font-weight: 600;">
                                                <i class="fas fa-list me-2"></i>Daftar Barang (<span id="itemCount">0</span> item)
                                            </h6>
                                            <div id="itemsContainer"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-section">
                                    <div class="text-center">
                                        <button type="submit" class="btn btn-primary btn-lg px-5 me-2" id="submitBtn">
                                            <i class="fas fa-paper-plane me-2"></i>Kirim Pengajuan
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-lg px-5" id="resetBtn">
                                            <i class="fas fa-undo me-2"></i>Reset Form
                                        </button>
                                    </div>
                                    <div id="successMessage" style="display: none; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, var(--primary-dark), var(--primary-light)); color: white; border-radius: 12px; text-align: center;">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <span id="successText">Pengajuan berhasil dikirim!</span>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="info-card">
                            <h6 style="color: var(--primary-dark); font-weight: 600; margin-bottom: 1rem;">
                                <i class="fas fa-info-circle me-2"></i>Status Koneksi Database
                            </h6>
                            <ul class="mb-0" style="color: var(--primary-dark);">
                                <li>Status: <strong id="connectionStatus">Memuat...</strong></li>
                                <li>Total Pegawai: <strong id="totalUsers">-</strong></li>
                                <li>Total Barang: <strong id="totalBarang">-</strong></li>
                                <li>Last Update: <strong id="lastUpdate">-</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- RIWAYAT PAGE -->
    <div id="riwayatPage" class="page-section">
        <section class="header-section">
            <div class="container text-center">
                <div style="font-size: 4rem; color: white; margin-bottom: 2rem;">
                    <i class="fas fa-history"></i>
                </div>
                <h1 class="header-title">Riwayat Pengajuan</h1>
                <p style="font-size: 1.25rem; color: rgba(255, 255, 255, 0.9);">Daftar Pengajuan Barang Terbaru</p>
            </div>
        </section>
        <div class="main-container">
            <div class="container">
                <div class="stats-card">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalPengajuan">0</div>
                            <div class="stat-label">Total Pengajuan</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalItems">0</div>
                            <div class="stat-label">Total Item</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="riwayatLastUpdate">-</div>
                            <div class="stat-label">Last Update</div>
                        </div>
                    </div>
                </div>
                <div class="content-card">
                    <div class="search-filter-bar">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control" id="searchInput" placeholder="Cari nama pegawai, barang, atau keterangan...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select filter-select" id="filterPegawai">
                                    <option value="">Semua Pegawai</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select filter-select" id="filterBarang">
                                    <option value="">Semua Barang</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3 style="color: var(--primary-dark); margin: 0;">
                            <i class="fas fa-list me-2"></i>Data Pengajuan
                        </h3>
                        <span style="color: var(--primary-light); font-size: 0.9rem;">
                            Showing <span id="showingRange">0-0</span> of <span id="totalRecords">0</span>
                        </span>
                    </div>
                    <div id="tableLoadingSkeleton">
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                    </div>
                    <div id="tableContent" style="display: none;">
                        <div class="scroll-hint">
                            <i class="fas fa-arrows-alt-h me-2"></i>Geser ke kanan untuk melihat lebih banyak
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th style="min-width: 160px;">Timestamp</th>
                                        <th style="min-width: 150px;">Nama Pegawai</th>
                                        <th style="min-width: 150px;">Nama Barang</th>
                                        <th style="min-width: 100px;">Jumlah</th>
                                        <th style="min-width: 200px;">Keterangan</th>
                                        <th style="min-width: 100px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody"></tbody>
                            </table>
                        </div>
                        <div id="emptyState" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <h5>Belum Ada Data</h5>
                            <p>Belum ada pengajuan yang tercatat</p>
                        </div>
                        <nav id="paginationNav" style="display: none;">
                            <ul class="pagination justify-content-center" id="pagination"></ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- REKAP PAGE -->
    <div id="rekapPage" class="page-section">
        <section class="header-section">
            <div class="container text-center">
                <div style="font-size: 4rem; color: white; margin-bottom: 2rem;">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h1 class="header-title">Rekap Pengeluaran</h1>
                <p style="font-size: 1.25rem; color: rgba(255, 255, 255, 0.9);">Laporan Bulanan</p>
            </div>
        </section>
        <div class="main-container">
            <div class="container">
                <div class="content-card">
                    <h4 class="mb-4"><i class="fas fa-filter me-2"></i>Filter Periode</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label">Tahun</label>
                            <select class="form-select" id="filterTahun"></select>
<script>
  const select = document.getElementById("filterTahun");
  const startYear = 2024;
  const endYear = new Date().getFullYear() + 5;
  for (let year = startYear; year <= endYear; year++) {
    let option = document.createElement("option");
    option.value = year;
    option.textContent = year;
    select.appendChild(option);
  }
</script>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Bulan</label>
                            <select class="form-select" id="filterBulan">
                                <option value="01">Januari</option>
                                <option value="02">Februari</option>
                                <option value="03">Maret</option>
                                <option value="04">April</option>
                                <option value="05">Mei</option>
                                <option value="06">Juni</option>
                                <option value="07">Juli</option>
                                <option value="08">Agustus</option>
                                <option value="09">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-primary w-100" onclick="loadRecapData()">
                                <i class="fas fa-search me-2"></i>Tampilkan
                            </button>
                        </div>
                    </div>
                    <div id="rekapTableLoading" style="display: none;">
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                        <div class="skeleton skeleton-row"></div>
                    </div>
                    <div id="rekapTableContent" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5><i class="fas fa-table me-2"></i>Hasil Rekap</h5>
                            <button class="btn btn-export" onclick="downloadExcel()" id="downloadExcelBtn">
                                <i class="fas fa-download me-2"></i>Download Excel
                            </button>
                        </div>
                        <div class="scroll-hint">
                            <i class="fas fa-arrows-alt-h me-2"></i>Geser ke kanan untuk melihat semua kolom
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped" id="rekapTable">
                                <thead>
                                    <tr>
                                        <th style="min-width: 50px;">No</th>
                                        <th style="min-width: 200px;">Nama Barang</th>
                                        <th style="min-width: 80px;">Jumlah</th>
                                        <th style="min-width: 80px;">Satuan</th>
                                        <th style="min-width: 250px;">Keterangan</th>
                                    </tr>
                                </thead>
                                <tbody id="rekapTableBody"></tbody>
                            </table>
                        </div>
                        <div id="rekapEmpty" class="text-center py-5" style="display: none; color: var(--primary-light);">
                            <i class="fas fa-inbox" style="font-size: 4rem; opacity: 0.5;"></i>
                            <h5>Tidak Ada Data</h5>
                            <p>Belum ada pengajuan untuk periode ini</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CETAK DOKUMEN PAGE -->
    <div id="cetakPage" class="page-section">
        <section class="header-section">
            <div class="container text-center">
                <div style="font-size: 4rem; color: white; margin-bottom: 2rem;">
                    <i class="fas fa-print"></i>
                </div>
                <h1 class="header-title">Cetak Dokumen</h1>
                <p style="font-size: 1.25rem; color: rgba(255, 255, 255, 0.9);">Surat Permintaan Barang ATK & ARK</p>
            </div>
        </section>
        <div class="main-container">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card form-card border-0">
                            <div class="form-header">
                                <h2 class="h3 mb-2" style="color: var(--primary-dark);">
                                    <i class="fas fa-file-word me-2"></i>Generate Surat Permintaan Barang
                                </h2>
                                <p class="mb-0" style="color: var(--primary-light);">Data diambil dari pengajuan yang telah disetujui</p>
                            </div>
                            <div class="p-4">
                                <div class="input-section">
                                    <h3>Generate Surat Permintaan Barang</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="selectTahun">Tahun:</label>
                                            <select id="selectTahun"><option value="">-- Pilih --</option></select>
                                        </div>
                                        <div class="form-group">
                                            <label for="selectBulan">Bulan:</label>
                                            <select id="selectBulan">
                                                <option value="">-- Pilih --</option>
                                                <option value="1">Januari</option>
                                                <option value="2">Februari</option>
                                                <option value="3">Maret</option>
                                                <option value="4">April</option>
                                                <option value="5">Mei</option>
                                                <option value="6">Juni</option>
                                                <option value="7">Juli</option>
                                                <option value="8">Agustus</option>
                                                <option value="9">September</option>
                                                <option value="10">Oktober</option>
                                                <option value="11">November</option>
                                                <option value="12">Desember</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="selectPenerimaBarang">Penerima Barang:</label>
                                            <select id="selectPenerimaBarang"><option value="">-- Pilih --</option></select>
                                        </div>
                                    </div>
                                    <button class="btn-generate" onclick="generateDocument()">Generate Dokumen</button>
                                    <div class="loading" id="loadingMessage">Memuat data...</div>
                                    <div class="error-message" id="errorMessage"></div>
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-success" onclick="exportToWord()">Export Word</button>
                                </div>
                                <div id="document-content" class="mt-4">
                                    <table class="header-table">
                                        <tr>
                                            <td class="logo-column">
                                                <div class="logo-container">
                                                    <img src="logo.png" alt="Logo BPS Tanjungpinang" id="mainLogo" onerror="this.style.display='none'">
                                                </div>
                                            </td>
                                            <td class="spacer-column">&nbsp;</td>
                                            <td class="info-column">
                                                <table class="info-table">
                                                    <tr>
                                                        <td class="info-label">*) Nomor</td>
                                                        <td class="info-separator">:</td>
                                                        <td class="info-value">................</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="info-label">*) Dibukukan</td>
                                                        <td class="info-separator">:</td>
                                                        <td class="info-value">................</td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                    <div class="document-title" id="documentTitle">SURAT PERMINTAAN BARANG ATK & ARK BULAN [BULAN] [TAHUN]</div>
                                    <div class="work-unit">Unit Kerja : BPS Kota Tanjungpinang</div>
                                    <table class="main-table">
                                        <thead>
                                            <tr>
                                                <th rowspan="2" class="no-column">No.</th>
                                                <th rowspan="2" class="name-column">Nama Barang</th>
                                                <th colspan="2">Banyaknya</th>
                                                <th rowspan="2" class="unit-column">Satuan</th>
                                                <th rowspan="2" class="note-column">Keterangan</th>
                                            </tr>
                                            <tr>
                                                <th class="qty-column">Diminta</th>
                                                <th class="qty-column">Disetujui*)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableBody">
                                            <tr class="data-row">
                                                <td>(1)</td>
                                                <td class="name-column">(2)</td>
                                                <td>(3)</td>
                                                <td>(4)</td>
                                                <td>(5)</td>
                                                <td>(6)</td>
                                            </tr>
                                            <tr class="data-row">
                                                <td colspan="6" style="text-align: center; color: #999;">-- Generate dokumen untuk menampilkan data --</td>
                                            </tr>
                                            <tr class="signature-row">
                                                <td colspan="6" style="padding: 15px;">
                                                    <table style="width: 100%; border: none;">
                                                        <tr>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                Setuju Dikeluarkan :<br>Pejabat Pengadaan
                                                            </td>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                <span id="tanggalSurat">Tanjungpinang, ........................ 2025.-</span><br>
                                                                Kepala Sub Bagian Umum
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr class="signature-row">
                                                <td colspan="6" style="padding: 15px;">
                                                    <table style="width: 100%; border: none;">
                                                        <tr>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                <br><br><br><br>( ........................ )<br>NIP. ........................
                                                            </td>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                <br><br><br><br>( ........................ )<br>NIP. ........................
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr class="pengeluaran-title-row">
                                                <td colspan="6">PENGELUARAN BARANG</td>
                                            </tr>
                                            <tr class="pengeluaran-content-row">
                                                <td colspan="6">
                                                    <table style="width: 100%; border: none;">
                                                        <tr>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                Petugas Gudang,<br><br><br><br><br><br>( ........................ )<br>NIP. ........................
                                                            </td>
                                                            <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                                                Penerima Barang,<br><br><br><br><br><br>( ........................ )<br>NIP. ........................
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="note-kasubbag">*) Diisi Kasubbag</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer style="background: linear-gradient(135deg, var(--primary-dark), var(--primary-light)); color: white; padding: 3rem 0; margin-top: 4rem;">
        <div class="container text-center">
            <h5 class="mb-3">
                <i class="fas fa-boxes me-2"></i>LOGISTOK
            </h5>
            <p class="mb-2">Sistem Informasi Logistik dan Inventori</p>
            <p class="mb-0 opacity-75">
                <i class="fas fa-copyright me-1"></i>2025 - BPS Kota Tanjungpinang
            </p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // ============================================
        // SCROLL HANDLERS FOR TABLES
        // ============================================
        function initTableScrollHandlers() {
            const tableWrappers = document.querySelectorAll('.table-responsive');
            tableWrappers.forEach(wrapper => {
                updateScrollShadows(wrapper);
                wrapper.addEventListener('scroll', function() {
                    updateScrollShadows(this);
                });
                window.addEventListener('resize', function() {
                    updateScrollShadows(wrapper);
                });
            });
        }
        function updateScrollShadows(wrapper) {
            const scrollLeft = wrapper.scrollLeft;
            const scrollWidth = wrapper.scrollWidth;
            const clientWidth = wrapper.clientWidth;
            if (scrollLeft > 10) {
                wrapper.classList.add('scrolled-left');
            } else {
                wrapper.classList.remove('scrolled-left');
            }
            if (scrollLeft + clientWidth >= scrollWidth - 10) {
                wrapper.classList.add('scrolled-right');
            } else {
                wrapper.classList.remove('scrolled-right');
            }
        }
        // ============================================
        // LOGISTOK - JavaScript (Unminified & Fixed)
        // ============================================
        const GOOGLE_SHEETS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzZ_6GcaOLBayHjMtBPf5xCBemktRlGwKaUZGow3pX1we4UGemzuW75p65tD_f2x2bCqQ/exec';
        // Global Variables
        let userData = [];
        let barangData = [];
        let selectedItems = [];
        let currentSelectedBarang = null;
        let currentSelectedUser = null;
        let allPengajuanData = [];
        let filteredPengajuanData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let pendingTarikData = null;
        let tarikModal = null;
        let isLoggedIn = false;
        let currentUser = null;
        let loginModal = null;
        let rekapData = [];
        // ============================================
        // PAGE NAVIGATION
        // ============================================
        function showPage(page) {
            document.querySelectorAll(".page-section").forEach(section => {
                section.classList.remove("active");
            });
            document.querySelectorAll(".nav-link").forEach(link => {
                link.classList.remove("active");
            });
            if (page === 'form') {
                document.getElementById("formPage").classList.add("active");
                document.getElementById("navForm").classList.add("active");
            } else if (page === 'riwayat') {
                document.getElementById("riwayatPage").classList.add("active");
                document.getElementById("navRiwayat").classList.add("active");
                loadPengajuanData();
            } else if (page === 'rekap') {
                document.getElementById("rekapPage").classList.add("active");
                document.getElementById("navRekap").classList.add("active");
            } else if (page === 'cetak') {
                document.getElementById("cetakPage").classList.add("active");
                document.getElementById("navCetak").classList.add("active");
                loadCetakData();
            }
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
        function showPageWithAuth(page) {
            if (!isLoggedIn) {
                loginModal.show();
                return;
            }
            showPage(page);
        }
        // ============================================
        // AUTHENTICATION
        // ============================================
        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById("loginUsername").value;
            const password = document.getElementById("loginPassword").value;
            showLoading(true, "Memverifikasi...");
            try {
                const url = `${GOOGLE_SHEETS_WEB_APP_URL}?action=login&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
                const response = await fetch(url);
                const result = await response.json();
                if (result.status === 'success') {
                    isLoggedIn = true;
                    currentUser = result.user;
                    loginModal.hide();
                    showToast("Login berhasil!", "success");
                    showPage("rekap");
                } else {
                    showToast(result.message || "Login gagal", "error");
                }
            } catch (error) {
                console.error("Error login:", error);
                showToast("Terjadi kesalahan saat login", "error");
            } finally {
                showLoading(false);
            }
        }
        // ============================================
        // REKAP FUNCTIONS - FIXED VERSION
        // ============================================
        async function loadRecapData() {
            const tahun = document.getElementById("filterTahun").value;
            const bulan = document.getElementById("filterBulan").value;
            console.log('=== LOAD RECAP DATA ===');
            console.log('Filter:', { tahun, bulan });
            document.getElementById("rekapTableLoading").style.display = "block";
            document.getElementById("rekapTableContent").style.display = "none";
            try {
                const url = `${GOOGLE_SHEETS_WEB_APP_URL}?action=getRecap&tahun=${tahun}&bulan=${bulan}`;
                console.log('Request URL:', url);
                const response = await fetch(url);
                const result = await response.json();
                console.log('Response:', result);
                if (result.status === 'success') {
                    if (result.debug) {
                        console.log('Debug info:', result.debug);
                    }
                    rekapData = result.data;
                    renderRekapTable(result.data);
                    document.getElementById("rekapTableLoading").style.display = "none";
                    document.getElementById("rekapTableContent").style.display = "block";
                    if (result.data.length === 0) {
                        const namaBulan = getNamaBulan(bulan);
                        showToast(`Tidak ada data untuk periode ${namaBulan} ${tahun}`, "info");
                        if (result.debug) {
                            console.warn('Debug dari server:', result.debug);
                        }
                    } else {
                        showToast(`Berhasil memuat ${result.data.length} item barang`, "success");
                    }
                } else {
                    showToast(result.message || "Gagal memuat data", "error");
                    document.getElementById("rekapTableLoading").style.display = "none";
                }
            } catch (error) {
                console.error("Error loading recap:", error);
                showToast("Terjadi kesalahan saat memuat data", "error");
                document.getElementById("rekapTableLoading").style.display = "none";
            }
        }
        function renderRekapTable(data) {
            const tableBody = document.getElementById("rekapTableBody");
            const emptyState = document.getElementById("rekapEmpty");
            if (data.length === 0) {
                tableBody.innerHTML = "";
                emptyState.style.display = "block";
            } else {
                emptyState.style.display = "none";
                tableBody.innerHTML = data.map(item => `
                    <tr>
                        <td>${item.no}</td>
                        <td><strong>${item.nama_barang}</strong></td>
                        <td>${item.jumlah}</td>
                        <td>${item.satuan}</td>
                        <td style="max-width: 400px;">${item.keterangan || "-"}</td>
                    </tr>
                `).join("");
            }
        }
        function getNamaBulan(bulan) {
            const namaBulan = {
                '01': 'Januari', '02': 'Februari', '03': 'Maret',
                '04': 'April', '05': 'Mei', '06': 'Juni',
                '07': 'Juli', '08': 'Agustus', '09': 'September',
                '10': 'Oktober', '11': 'November', '12': 'Desember'
            };
            return namaBulan[bulan] || bulan;
        }
        // ============================================
        // DOWNLOAD EXCEL
        // ============================================
        function downloadExcel() {
            if (!rekapData || rekapData.length === 0) {
                showToast("Tidak ada data untuk didownload", "error");
                return;
            }
            const tahun = document.getElementById("filterTahun").value;
            const bulan = document.getElementById("filterBulan").value;
            const namaBulan = document.getElementById("filterBulan").selectedOptions[0].text;
            const ws_data = {};
            ws_data.A1 = {
                v: `Rekap Pengeluaran Barang Persediaan Bulan ${namaBulan} ${tahun}`,
                t: "s",
                s: {
                    font: { bold: true, sz: 14 },
                    alignment: { horizontal: "center", vertical: "center" }
                }
            };
            ws_data.A3 = { v: "No", t: "s", s: { font: { bold: true }, fill: { fgColor: { rgb: "006D77" } } } };
            ws_data.B3 = { v: "Nama Barang", t: "s", s: { font: { bold: true }, fill: { fgColor: { rgb: "006D77" } } } };
            ws_data.C3 = { v: "Jumlah", t: "s", s: { font: { bold: true }, fill: { fgColor: { rgb: "006D77" } } } };
            ws_data.D3 = { v: "Satuan", t: "s", s: { font: { bold: true }, fill: { fgColor: { rgb: "006D77" } } } };
            ws_data.E3 = { v: "Keterangan", t: "s", s: { font: { bold: true }, fill: { fgColor: { rgb: "006D77" } } } };
            rekapData.forEach((item, index) => {
                const row = index + 4;
                ws_data[`A${row}`] = { v: item.no, t: "n" };
                ws_data[`B${row}`] = { v: item.nama_barang, t: "s" };
                ws_data[`C${row}`] = { v: item.jumlah, t: "n" };
                ws_data[`D${row}`] = { v: item.satuan, t: "s" };
                ws_data[`E${row}`] = { v: item.keterangan || "-", t: "s" };
            });
            const lastRow = rekapData.length + 3;
            ws_data["!ref"] = `A1:E${lastRow}`;
            ws_data["!merges"] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 4 } }];
            ws_data["!cols"] = [
                { wch: 5 },
                { wch: 35 },
                { wch: 10 },
                { wch: 10 },
                { wch: 50 }
            ];
            ws_data["!rows"] = [
                { hpt: 25 },
                { hpt: 15 },
                { hpt: 20 }
            ];
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws_data, "Rekap Pengeluaran");
            const filename = `Rekap_Pengeluaran_${namaBulan}_${tahun}.xlsx`;
            XLSX.writeFile(wb, filename);
            showToast("File Excel berhasil didownload", "success");
        }
        // ============================================
        // BOOTSTRAP DROPDOWN CLASS
        // ============================================
        class BootstrapDropdown {
            constructor(containerId, inputId, menuId, data, config = {}) {
                this.container = document.getElementById(containerId);
                this.input = document.getElementById(inputId);
                this.menu = document.getElementById(menuId);
                this.data = data;
                this.filteredData = [...data];
                this.selectedIndex = -1;
                this.isOpen = false;
                this.lastQuery = "";
                this.config = {
                    searchKey: config.searchKey || "nama",
                    displayKey: config.displayKey || "nama",
                    icon: config.icon || "fas fa-search",
                    onSelect: config.onSelect || function() {},
                    renderCustom: config.renderCustom || null,
                    minChars: config.minChars || 1,
                    ...config
                };
                this.init();
            }
            init() {
                this.setupEventListeners();
                this.renderOptions();
            }
            setupEventListeners() {
                this.input.addEventListener("input", (e) => this.handleInput(e));
                this.input.addEventListener("focus", () => {
                    if (this.input.value.length >= this.config.minChars) {
                        this.open();
                    }
                });
                this.input.addEventListener("keydown", (e) => this.handleKeydown(e));
                document.addEventListener("click", (e) => {
                    if (!this.container.contains(e.target)) {
                        this.close();
                    }
                });
                this.menu.addEventListener("click", (e) => this.handleMenuClick(e));
            }
            handleInput(e) {
                const query = e.target.value.trim();
                if (query.length > 0) {
                    this.container.classList.add("typing");
                } else {
                    this.container.classList.remove("typing");
                }
                if (query.length >= this.config.minChars) {
                    this.filterData(query);
                    this.renderOptions();
                    this.selectedIndex = -1;
                    this.open();
                } else if (query.length === 0) {
                    this.filteredData = [...this.data];
                    this.renderOptions();
                    this.close();
                } else {
                    this.close();
                }
                this.lastQuery = query;
            }
            handleKeydown(e) {
                if (!this.isOpen && (e.key === "ArrowDown" || e.key === "ArrowUp")) {
                    if (this.input.value.length >= this.config.minChars) {
                        this.open();
                    }
                    return;
                }
                switch (e.key) {
                    case "ArrowDown":
                        e.preventDefault();
                        this.selectedIndex = Math.min(this.selectedIndex + 1, this.filteredData.length - 1);
                        this.updateHighlight();
                        break;
                    case "ArrowUp":
                        e.preventDefault();
                        this.selectedIndex = Math.max(this.selectedIndex - 1, -1);
                        this.updateHighlight();
                        break;
                    case "Enter":
                        e.preventDefault();
                        if (this.selectedIndex >= 0 && this.filteredData[this.selectedIndex]) {
                            this.selectItem(this.filteredData[this.selectedIndex]);
                        }
                        break;
                    case "Escape":
                        this.close();
                        this.input.blur();
                        break;
                }
            }
            handleMenuClick(e) {
                const item = e.target.closest(".custom-dropdown-item");
                if (item && !item.classList.contains("disabled")) {
                    const index = parseInt(item.dataset.index);
                    if (!isNaN(index) && this.filteredData[index]) {
                        this.selectItem(this.filteredData[index]);
                    }
                }
            }
            filterData(query) {
                const lowerQuery = query.toLowerCase();
                if (!query || query.length < this.config.minChars) {
                    this.filteredData = [...this.data];
                    return;
                }
                this.filteredData = this.data.filter(item => {
                    const searchValue = String(item[this.config.searchKey] || "").toLowerCase();
                    const nip = item.nip ? String(item.nip).toLowerCase() : "";
                    const satuan = item.satuan ? String(item.satuan).toLowerCase() : "";
                    return searchValue.includes(lowerQuery) || 
                           nip.includes(lowerQuery) || 
                           satuan.includes(lowerQuery);
                });
                this.filteredData.sort((a, b) => {
                    const aValue = String(a[this.config.searchKey] || "").toLowerCase();
                    const bValue = String(b[this.config.searchKey] || "").toLowerCase();
                    const aStarts = aValue.startsWith(lowerQuery);
                    const bStarts = bValue.startsWith(lowerQuery);
                    if (aStarts && !bStarts) return -1;
                    if (!aStarts && bStarts) return 1;
                    return aValue.localeCompare(bValue);
                });
            }
            renderOptions() {
                if (this.filteredData.length === 0) {
                    this.menu.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search mb-2" style="font-size: 2rem; opacity: 0.5;"></i>
                            <div>Tidak ada hasil ditemukan</div>
                        </div>
                    `;
                    return;
                }
                const query = this.lastQuery.toLowerCase();
                if (this.config.renderCustom) {
                    this.menu.innerHTML = this.config.renderCustom(this.filteredData, query);
                    return;
                }
                this.menu.innerHTML = this.filteredData.map((item, index) => {
                    const displayValue = item[this.config.displayKey];
                    const highlighted = highlightText(displayValue, query, this.config.minChars);
                    let subtitle = "";
                    if (item.nip) {
                        subtitle = `<small style="color: var(--primary-light);">${String(item.nip)}</small>`;
                    }
                    return `
                        <div class="custom-dropdown-item" data-index="${index}">
                            <i class="${this.config.icon} dropdown-item-icon"></i>
                            <div class="dropdown-item-text">${highlighted}</div>
                            <div>${subtitle}</div>
                        </div>
                    `;
                }).join("");
            }
            updateHighlight() {
                const items = this.menu.querySelectorAll(".custom-dropdown-item");
                items.forEach((item, index) => {
                    item.classList.toggle("active", index === this.selectedIndex);
                });
                if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
                    items[this.selectedIndex].scrollIntoView({ block: "nearest", behavior: "smooth" });
                }
            }
            selectItem(item) {
                this.input.value = item[this.config.displayKey];
                this.close();
                this.container.classList.remove("typing");
                this.config.onSelect(item);
            }
            open() {
                if (!this.isOpen) {
                    this.isOpen = true;
                    this.container.classList.add("show");
                    this.selectedIndex = -1;
                }
            }
            close() {
                if (this.isOpen) {
                    this.isOpen = false;
                    this.container.classList.remove("show");
                    this.container.classList.remove("typing");
                }
            }
            reset() {
                this.input.value = "";
                this.close();
                this.container.classList.remove("typing");
                this.filteredData = [...this.data];
                this.lastQuery = "";
                this.renderOptions();
            }
            updateData(newData) {
                this.data = newData;
                this.filteredData = [...newData];
                this.renderOptions();
            }
        }
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function highlightText(text, query, minChars = 1) {
            if (!query || query.length < minChars) {
                return text;
            }
            const escapeRegex = (str) => str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
            const regex = new RegExp(`(${escapeRegex(query)})`, "gi");
            return text.replace(regex, '<span class="highlight">$1</span>');
        }
        // ============================================
        // DATA LOADING
        // ============================================
        async function loadDataFromSheets() {
            try {
                const response = await fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getAll`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                if (result.status !== 'success' || !result.data) {
                    throw new Error(result.message || "Invalid response format");
                }
                userData = result.data.users.map(user => ({
                    id_user: user.id_user,
                    nama: user.nama,
                    nip: user.nip
                }));
                barangData = result.data.barang.map(item => ({
                    id_barang: item.id_barang,
                    nama: item.uraian,
                    uraian: item.uraian,
                    satuan: item.satuan,
                    tersedia: item.tersedia,
                    diajukan: item.diajukan,
                    disetujui: item.disetujui
                }));
                document.getElementById("userCount").textContent = userData.length;
                document.getElementById("barangCount").textContent = barangData.length;
                document.getElementById("totalUsers").textContent = userData.length;
                document.getElementById("totalBarang").textContent = barangData.length;
                document.getElementById("connectionStatus").textContent = "Terhubung ✓";
                document.getElementById("connectionStatus").style.color = "var(--primary-dark)";
                document.getElementById("lastUpdate").textContent = new Date().toLocaleString("id-ID");
                document.getElementById("formLoadingSkeleton").style.display = "none";
                document.getElementById("formPengambilanBarang").style.display = "block";
                showToast(`Data dimuat: ${userData.length} pegawai, ${barangData.length} barang`, "success");
            } catch (error) {
                console.error("Error loading data:", error);
                showToast("Gagal memuat data: " + error.message, "error");
                document.getElementById("connectionStatus").textContent = "Error ✗";
                document.getElementById("connectionStatus").style.color = "var(--accent-dark)";
                userData = [];
                barangData = [];
                document.getElementById("formLoadingSkeleton").style.display = "none";
                document.getElementById("formPengambilanBarang").style.display = "block";
            }
        }
        // ============================================
        // DROPDOWN INITIALIZATION
        // ============================================
        function initializeDropdowns() {
            window.pegawaiDropdown = new BootstrapDropdown(
                "pegawaiDropdown",
                "namaPegawai",
                "pegawaiMenu",
                userData,
                {
                    searchKey: "nama",
                    displayKey: "nama",
                    icon: "fas fa-user",
                    minChars: 1,
                    onSelect: function(user) {
                        currentSelectedUser = user;
                        showToast(`Pegawai ${user.nama} dipilih`, "success");
                    }
                }
            );
            window.barangDropdown = new BootstrapDropdown(
                "barangDropdown",
                "namaBarang",
                "barangMenu",
                barangData,
                {
                    searchKey: "nama",
                    displayKey: "nama",
                    icon: "fas fa-cube",
                    minChars: 1,
                    renderCustom: function(items, query) {
                        return items.map((item, index) => {
                            const highlighted = highlightText(item.nama, query, 1);
                            const stockClass = item.tersedia > 20 ? "high" : (item.tersedia > 5 ? "medium" : "low");
                            const stockText = item.tersedia === 0 ? "Habis" : item.tersedia;
                            const isAdded = selectedItems.some(selected => selected.id_barang === item.id_barang);
                            const disabledClass = isAdded ? "disabled" : "";
                            const addedBadge = isAdded ? '<span style="margin-left: 0.5rem; font-size: 0.7rem; background: var(--accent-dark); color: white; padding: 0.1rem 0.4rem; border-radius: 4px;">✓ Ditambahkan</span>' : "";
                            return `
                                <div class="custom-dropdown-item ${disabledClass}" data-index="${index}">
                                    <i class="fas fa-cube dropdown-item-icon"></i>
                                    <div class="dropdown-item-text">
                                        ${highlighted} ${addedBadge}
                                        <small style="display: block; color: var(--primary-light); font-size: 0.85em; margin-top: 0.25rem;">
                                            ${item.satuan} | Tersedia: ${stockText}
                                        </small>
                                    </div>
                                    <span class="stock-badge ${stockClass}">${stockText}</span>
                                </div>
                            `;
                        }).join("");
                    },
                    onSelect: function(item) {
                        if (selectedItems.some(selected => selected.id_barang === item.id_barang)) {
                            showToast("Barang ini sudah ada di daftar!", "error");
                            return;
                        }
                        currentSelectedBarang = item;
                        document.getElementById("satuan").value = item.satuan;
                        const jumlahInput = document.getElementById("jumlah");
                        if (item.tersedia === 0) {
                            jumlahInput.disabled = true;
                            jumlahInput.placeholder = "Stok habis";
                            jumlahInput.value = "";
                            showToast(`${item.nama} stok habis!`, "error");
                        } else {
                            jumlahInput.disabled = false;
                            jumlahInput.placeholder = `Max: ${item.tersedia}`;
                            jumlahInput.max = item.tersedia;
                            jumlahInput.focus();
                            showToast(`${item.nama} dipilih (Stok: ${item.tersedia})`, "success");
                        }
                    }
                }
            );
        }
        // ============================================
        // FORM HANDLERS
        // ============================================
        function initializeFormHandlers() {
            document.getElementById("addItemBtn").addEventListener("click", addItemToList);
            document.getElementById("resetBtn").addEventListener("click", resetForm);
            document.getElementById("formPengambilanBarang").addEventListener("submit", function(e) {
                e.preventDefault();
                submitForm();
            });
        }
        function addItemToList() {
            const namaBarang = document.getElementById("namaBarang").value;
            const jumlah = parseInt(document.getElementById("jumlah").value);
            const satuan = document.getElementById("satuan").value;
            const keterangan = document.getElementById("keterangan").value.trim();
            if (!currentSelectedBarang) {
                showToast("Pilih barang terlebih dahulu", "error");
                return;
            }
            if (selectedItems.some(item => item.id_barang === currentSelectedBarang.id_barang)) {
                showToast(`${namaBarang} sudah ada di daftar!`, "error");
                return;
            }
            if (!jumlah || jumlah <= 0) {
                document.getElementById("jumlah").focus();
                showToast("Masukkan jumlah yang valid", "error");
                return;
            }
            if (jumlah > currentSelectedBarang.tersedia) {
                document.getElementById("jumlah").value = currentSelectedBarang.tersedia;
                showToast(`Jumlah melebihi stok tersedia (${currentSelectedBarang.tersedia})`, "error");
                return;
            }
            if (!keterangan) {
                document.getElementById("keterangan").focus();
                showToast("Isi keterangan penggunaan untuk barang ini", "error");
                return;
            }
            selectedItems.push({
                id_barang: currentSelectedBarang.id_barang,
                nama: namaBarang,
                jumlah: jumlah,
                satuan: satuan,
                keterangan: keterangan,
                stok_tersedia: currentSelectedBarang.tersedia
            });
            renderItemsList();
            clearCurrentSelection();
            showToast(`${namaBarang} ditambahkan ke daftar`, "success");
            document.getElementById("namaBarang").focus();
        }
        function renderItemsList() {
            const itemsList = document.getElementById("itemsList");
            const itemsContainer = document.getElementById("itemsContainer");
            const itemCount = document.getElementById("itemCount");
            if (selectedItems.length === 0) {
                itemsList.style.display = "none";
            } else {
                itemsList.style.display = "block";
                itemCount.textContent = selectedItems.length;
                itemsContainer.innerHTML = selectedItems.map((item, index) => `
                    <div class="item-card">
                        <div class="item-header">
                            <div style="flex: 1;">
                                <div class="item-name">${item.nama}</div>
                                <div class="item-quantity">${item.jumlah} ${item.satuan}</div>
                            </div>
                            <button type="button" class="remove-btn" onclick="removeItem(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="item-keterangan">
                            <i class="fas fa-info-circle me-1"></i>${item.keterangan}
                        </div>
                    </div>
                `).join("");
            }
        }
        function removeItem(index) {
            const item = selectedItems[index];
            selectedItems.splice(index, 1);
            renderItemsList();
            showToast(`${item.nama} dihapus dari daftar`, "info");
            if (window.barangDropdown && window.barangDropdown.isOpen) {
                window.barangDropdown.renderOptions();
            }
        }
        function clearCurrentSelection() {
            document.getElementById("namaBarang").value = "";
            document.getElementById("jumlah").value = "";
            document.getElementById("satuan").value = "";
            document.getElementById("keterangan").value = "";
            document.getElementById("jumlah").disabled = false;
            document.getElementById("jumlah").placeholder = "0";
            currentSelectedBarang = null;
            if (window.barangDropdown) {
                window.barangDropdown.reset();
            }
        }
        function resetForm() {
            if ((selectedItems.length > 0 || document.getElementById("namaPegawai").value) && 
                !confirm("Yakin ingin reset form? Semua data akan hilang.")) {
                return;
            }
            document.getElementById("formPengambilanBarang").reset();
            clearCurrentSelection();
            selectedItems = [];
            currentSelectedUser = null;
            renderItemsList();
            document.getElementById("successMessage").style.display = "none";
            if (window.pegawaiDropdown) {
                window.pegawaiDropdown.reset();
            }
            showToast("Form berhasil direset", "info");
        }
        async function submitForm() {
            const namaPegawai = document.getElementById("namaPegawai").value;
            if (!namaPegawai) {
                showToast("Pilih nama pegawai terlebih dahulu", "error");
                return;
            }
            if (!currentSelectedUser) {
                showToast("Data pegawai tidak valid. Pilih ulang dari dropdown.", "error");
                return;
            }
            if (selectedItems.length === 0) {
                showToast("Tambahkan minimal 1 barang", "error");
                return;
            }
            const dataToSend = {
                pegawai: currentSelectedUser,
                items: selectedItems,
                timestamp: new Date().toLocaleString("id-ID"),
                total_items: selectedItems.length
            };
            const submitBtn = document.getElementById("submitBtn");
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Mengirim...';
            submitBtn.disabled = true;
            showLoading(true, "Mengirim pengajuan...");
            try {
                await fetch(GOOGLE_SHEETS_WEB_APP_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(dataToSend)
                });
                submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Berhasil!';
                const successMessage = document.getElementById("successMessage");
                document.getElementById("successText").textContent = 
                    `Pengajuan berhasil dikirim! ${selectedItems.length} item barang telah diproses.`;
                successMessage.style.display = "block";
                showToast(`Pengajuan berhasil! ${selectedItems.length} item tersimpan di database.`, "success");
                await loadDataFromSheets();
                setTimeout(() => {
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    document.getElementById("formPengambilanBarang").reset();
                    clearCurrentSelection();
                    selectedItems = [];
                    currentSelectedUser = null;
                    renderItemsList();
                    successMessage.style.display = "none";
                    if (window.pegawaiDropdown) {
                        window.pegawaiDropdown.reset();
                    }
                    window.scrollTo({ top: 0, behavior: "smooth" });
                    showToast("Form berhasil direset", "info");
                }, 2000);
            } catch (error) {
                console.error("Error submitting form:", error);
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
                showToast("Terjadi kesalahan saat mengirim data. Silakan coba lagi.", "error");
            } finally {
                showLoading(false);
            }
        }
        // ============================================
        // RIWAYAT PENGAJUAN
        // ============================================
        async function loadPengajuanData() {
            try {
                document.getElementById("tableLoadingSkeleton").style.display = "block";
                document.getElementById("tableContent").style.display = "none";
                const response = await fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getPengajuan`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                if (result.status !== 'success' || !result.data) {
                    throw new Error(result.message || "Invalid response format");
                }
                allPengajuanData = result.data;
                allPengajuanData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                filteredPengajuanData = allPengajuanData;
                populateFilters();
                updateStats();
                renderTable();
                renderPagination();
                document.getElementById("tableLoadingSkeleton").style.display = "none";
                document.getElementById("tableContent").style.display = "block";
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById("tableLoadingSkeleton").style.display = "none";
                document.getElementById("tableContent").style.display = "block";
                document.getElementById("emptyState").style.display = "block";
            }
        }
        function populateFilters() {
            const pegawaiList = [...new Set(allPengajuanData.map(item => item.nama_pegawai))].sort();
            const barangList = [...new Set(allPengajuanData.map(item => item.nama_barang))].sort();
            const filterPegawai = document.getElementById("filterPegawai");
            const filterBarang = document.getElementById("filterBarang");
            filterPegawai.innerHTML = '<option value="">Semua Pegawai</option>' +
                pegawaiList.map(nama => `<option value="${nama}">${nama}</option>`).join("");
            filterBarang.innerHTML = '<option value="">Semua Barang</option>' +
                barangList.map(nama => `<option value="${nama}">${nama}</option>`).join("");
            document.getElementById("searchInput").addEventListener("input", applyFilters);
            filterPegawai.addEventListener("change", applyFilters);
            filterBarang.addEventListener("change", applyFilters);
        }
        function applyFilters() {
            const searchQuery = document.getElementById("searchInput").value.toLowerCase();
            const filterPegawai = document.getElementById("filterPegawai").value;
            const filterBarang = document.getElementById("filterBarang").value;
            filteredPengajuanData = allPengajuanData.filter(item => {
                const matchSearch = !searchQuery || 
                    item.nama_pegawai.toLowerCase().includes(searchQuery) ||
                    item.nama_barang.toLowerCase().includes(searchQuery) ||
                    item.keterangan.toLowerCase().includes(searchQuery);
                const matchPegawai = !filterPegawai || item.nama_pegawai === filterPegawai;
                const matchBarang = !filterBarang || item.nama_barang === filterBarang;
                return matchSearch && matchPegawai && matchBarang;
            });
            currentPage = 1;
            updateStats();
            renderTable();
            renderPagination();
        }
        function updateStats() {
            document.getElementById("totalPengajuan").textContent = filteredPengajuanData.length;
            const totalItems = filteredPengajuanData.reduce((sum, item) => sum + (item.jumlah || 0), 0);
            document.getElementById("totalItems").textContent = totalItems;
            document.getElementById("riwayatLastUpdate").textContent = 
                new Date().toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" });
        }
        function renderTable() {
            const tableBody = document.getElementById("dataTableBody");
            const emptyState = document.getElementById("emptyState");
            if (filteredPengajuanData.length === 0) {
                tableBody.innerHTML = "";
                emptyState.style.display = "block";
                document.getElementById("paginationNav").style.display = "none";
                return;
            }
            emptyState.style.display = "none";
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredPengajuanData.slice(startIndex, endIndex);
            tableBody.innerHTML = pageData.map(item => `
                <tr>
                    <td>
                        <span class="badge-timestamp">
                            <i class="far fa-clock me-1"></i>${formatTimestamp(item.timestamp)}
                        </span>
                    </td>
                    <td><strong>${item.nama_pegawai}</strong></td>
                    <td>${item.nama_barang}</td>
                    <td>
                        <span class="badge-quantity">${item.jumlah} ${item.satuan}</span>
                    </td>
                    <td>
                        <div style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-style: italic; color: var(--primary-light);" 
                             title="${item.keterangan}">
                            ${item.keterangan}
                        </div>
                    </td>
                    <td style="text-align: center;">
                        <button class="btn-tarik" onclick='showTarikModal(${JSON.stringify(item)})'>
                            <i class="fas fa-undo me-1"></i>Tarik
                        </button>
                    </td>
                </tr>
            `).join("");
            document.getElementById("showingRange").textContent = `${startIndex + 1}-${Math.min(endIndex, filteredPengajuanData.length)}`;
            document.getElementById("totalRecords").textContent = filteredPengajuanData.length;
        }
        function showTarikModal(data) {
            pendingTarikData = data;
            document.getElementById("modalNamaBarang").textContent = data.nama_barang;
            document.getElementById("modalJumlah").textContent = `${data.jumlah} ${data.satuan}`;
            document.getElementById("modalNamaPegawai").textContent = data.nama_pegawai;
            tarikModal.show();
        }
        async function confirmTarik() {
            if (!pendingTarikData) return;
            tarikModal.hide();
            showLoading(true, "Menarik pengajuan...");
            try {
                const dataToSend = {
                    action: "tarikPengajuan",
                    row_index: pendingTarikData.row_index,
                    nama_barang: pendingTarikData.nama_barang,
                    jumlah: pendingTarikData.jumlah
                };
                await fetch(GOOGLE_SHEETS_WEB_APP_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(dataToSend)
                });
                showToast("Pengajuan berhasil ditarik dan stok dikembalikan", "success");
                await loadDataFromSheets();
                await loadPengajuanData();
            } catch (error) {
                console.error("Error tarik pengajuan:", error);
                showToast("Terjadi kesalahan saat menarik pengajuan", "error");
            } finally {
                showLoading(false);
                pendingTarikData = null;
            }
        }
        function renderPagination() {
            const pagination = document.getElementById("pagination");
            const paginationNav = document.getElementById("paginationNav");
            if (filteredPengajuanData.length === 0) {
                paginationNav.style.display = "none";
                return;
            }
            const totalPages = Math.ceil(filteredPengajuanData.length / itemsPerPage);
            if (totalPages <= 1) {
                paginationNav.style.display = "none";
                return;
            }
            paginationNav.style.display = "block";
            let html = "";
            html += `
                <li class="page-item ${currentPage === 1 ? "disabled" : ""}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `
                        <li class="page-item ${currentPage === i ? "active" : ""}">
                            <a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            html += `
                <li class="page-item ${currentPage === totalPages ? "disabled" : ""}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            pagination.innerHTML = html;
        }
        function changePage(page) {
            const totalPages = Math.ceil(filteredPengajuanData.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
            renderPagination();
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleString("id-ID", {
                day: "2-digit",
                month: "short",
                year: "numeric",
                hour: "2-digit",
                minute: "2-digit"
            });
        }
        // ============================================
        // CETAK DOKUMEN FUNCTIONS
        // ============================================
        let dataPeran = [];
        let dataUsers = [];
        let selectedTahun = '';
        let selectedBulan = '';
        let selectedUser = null;
        const BULAN_NAMES = {
            '1': 'Januari', '2': 'Februari', '3': 'Maret', '4': 'April',
            '5': 'Mei', '6': 'Juni', '7': 'Juli', '8': 'Agustus',
            '9': 'September', '10': 'Oktober', '11': 'November', '12': 'Desember'
        };
        async function loadCetakData() {
            showLoading(true);
            try {
                const [peran, users, periods] = await Promise.all([
                    fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getPeran`).then(r => r.json()),
                    fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getUsers`).then(r => r.json()),
                    fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getAvailablePeriods`).then(r => r.json())
                ]);
                if (peran.status === 'success') dataPeran = peran.data;
                if (users.status === 'success') {
                    dataUsers = users.data;
                    const select = document.getElementById('selectPenerimaBarang');
                    select.innerHTML = '<option value="">-- Pilih --</option>';
                    users.data.forEach(u => {
                        const opt = document.createElement('option');
                        opt.value = u.id_user;
                        opt.textContent = `${u.nama} (${u.nip})`;
                        opt.dataset.nama = u.nama;
                        opt.dataset.nip = u.nip;
                        select.appendChild(opt);
                    });
                }
                if (periods.status === 'success') {
                    const select = document.getElementById('selectTahun');
                    select.innerHTML = '<option value="">-- Pilih --</option>';
                    periods.years.forEach(y => {
                        const opt = document.createElement('option');
                        opt.value = y;
                        opt.textContent = y;
                        select.appendChild(opt);
                    });
                }
                showLoading(false);
            } catch (error) {
                showError('Gagal memuat data: ' + error.message);
                showLoading(false);
            }
        }
        async function generateDocument() {
            selectedTahun = document.getElementById('selectTahun').value;
            selectedBulan = document.getElementById('selectBulan').value;
            const selectedUserId = document.getElementById('selectPenerimaBarang').value;
            if (!selectedTahun || !selectedBulan || !selectedUserId) {
                showError('Mohon lengkapi semua field!');
                return;
            }
            const userSelect = document.getElementById('selectPenerimaBarang');
            const selectedOption = userSelect.options[userSelect.selectedIndex];
            selectedUser = {
                id: selectedUserId,
                nama: selectedOption.dataset.nama,
                nip: selectedOption.dataset.nip
            };
            showLoading(true);
            showError('');
            try {
                const response = await fetch(`${GOOGLE_SHEETS_WEB_APP_URL}?action=getPengajuan`);
                const result = await response.json();
                if (result.status === 'success' && result.data && result.data.length > 0) {
                    const filtered = result.data.filter(item => {
                        const itemTahun = parseInt(item.tahun);
                        const itemBulan = parseInt(item.bulan);
                        const itemUserId = parseInt(item.id_user);
                        return itemTahun === parseInt(selectedTahun) && 
                               itemBulan === parseInt(selectedBulan) && 
                               itemUserId === parseInt(selectedUserId);
                    });
                    if (filtered.length > 0) {
                        const agregasi = {};
                        filtered.forEach(item => {
                            if (!agregasi[item.nama_barang]) {
                                agregasi[item.nama_barang] = {
                                    nama_barang: item.nama_barang,
                                    jumlah: 0,
                                    satuan: item.satuan,
                                    keterangan_list: []
                                };
                            }
                            agregasi[item.nama_barang].jumlah += parseInt(item.jumlah) || 0;
                            if (item.keterangan && item.keterangan.trim() !== '') {
                                agregasi[item.nama_barang].keterangan_list.push(item.keterangan);
                            }
                        });
                        const dataAggregated = Object.values(agregasi).map(item => {
                            const uniqueKeterangan = [...new Set(item.keterangan_list)];
                            return {
                                nama_barang: item.nama_barang,
                                jumlah: item.jumlah,
                                satuan: item.satuan,
                                keterangan: uniqueKeterangan.length > 0 ? uniqueKeterangan.join('; ') : '-'
                            };
                        });
                        dataAggregated.sort((a, b) => a.nama_barang.localeCompare(b.nama_barang));
                        populateDocument(dataAggregated);
                        showLoading(false);
                    } else {
                        showError(`Tidak ada pengajuan untuk ${selectedUser.nama} di periode yang dipilih!`);
                        showLoading(false);
                    }
                } else {
                    showError('Tidak ada data pengajuan!');
                    showLoading(false);
                }
            } catch (error) {
                showError('Gagal memuat data: ' + error.message);
                showLoading(false);
            }
        }
        function populateDocument(data) {
            const bulanName = BULAN_NAMES[selectedBulan];
            document.getElementById('documentTitle').textContent = 
                `SURAT PERMINTAAN BARANG ATK & ARK BULAN ${bulanName.toUpperCase()} ${selectedTahun}`;
            document.getElementById('tanggalSurat').textContent = 
                `Tanjungpinang, ........................ ${selectedTahun}.-`;
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            const headerRow = `<tr class="data-row"><td>(1)</td><td class="name-column">(2)</td><td>(3)</td><td>(4)</td><td>(5)</td><td>(6)</td></tr>`;
            tbody.insertAdjacentHTML('beforeend', headerRow);
            data.forEach((item, i) => {
                const row = `<tr class="data-row">
                    <td>${i + 1}.</td>
                    <td class="name-column">${item.nama_barang}</td>
                    <td>${item.jumlah}</td>
                    <td>${item.jumlah}</td>
                    <td>${item.satuan}</td>
                    <td>${item.keterangan || '-'}</td>
                </tr>`;
                tbody.insertAdjacentHTML('beforeend', row);
            });
            const pejabatPengadaan = dataPeran.find(p => p.jabatan.toLowerCase().includes('pengadaan'));
            const kasubbag = dataPeran.find(p => p.jabatan.toLowerCase().includes('sub bagian umum'));
            const petugasGudang = dataPeran.find(p => p.jabatan.toLowerCase().includes('gudang'));
            const signatureRows = `
                <tr class="signature-row">
                    <td colspan="6" style="padding: 15px;">
                        <table style="width: 100%; border: none;">
                            <tr>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    Setuju Dikeluarkan :<br>Pejabat Pengadaan
                                </td>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    Tanjungpinang, ........................ ${selectedTahun}.-<br>
                                    Kepala Sub Bagian Umum
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr class="signature-row">
                    <td colspan="6" style="padding: 15px;">
                        <table style="width: 100%; border: none;">
                            <tr>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    <br><br><br><br>
                                    ( ${pejabatPengadaan ? pejabatPengadaan.nama : '........................'} )<br>
                                    NIP. ${pejabatPengadaan ? pejabatPengadaan.nip : '........................'}
                                </td>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    <br><br><br><br>
                                    ( ${kasubbag ? kasubbag.nama : '........................'} )<br>
                                    NIP. ${kasubbag ? kasubbag.nip : '........................'}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr class="pengeluaran-title-row">
                    <td colspan="6">PENGELUARAN BARANG</td>
                </tr>
                <tr class="pengeluaran-content-row">
                    <td colspan="6">
                        <table style="width: 100%; border: none;">
                            <tr>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    Petugas Gudang,<br><br><br><br><br><br>
                                    ( ${petugasGudang ? petugasGudang.nama : '........................'} )<br>
                                    NIP. ${petugasGudang ? petugasGudang.nip : '........................'}
                                </td>
                                <td style="border: none; width: 50%; text-align: center; vertical-align: top;">
                                    Penerima Barang,<br><br><br><br><br><br>
                                    ( ${selectedUser ? selectedUser.nama : '........................'} )<br>
                                    NIP. ${selectedUser ? selectedUser.nip : '........................'}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', signatureRows);
        }
        function exportToWord() {
            const content = document.getElementById('document-content').innerHTML;
            const bulanName = BULAN_NAMES[selectedBulan] || 'September';
            const userName = selectedUser ? selectedUser.nama.replace(/\s+/g, '_') : 'User';
            const fileName = `Surat_Permintaan_ATK_${bulanName}_${selectedTahun}_${userName}.doc`;
            const wordDoc = `<html xmlns:o='urn:schemas-microsoft-com:office:office' 
                  xmlns:w='urn:schemas-microsoft-com:office:word' 
                  xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>Surat Permintaan Barang</title>
            <style>
                body{font-family:'Times New Roman',serif;font-size:12pt;margin:20px;line-height:1.4}
                table{border-collapse:collapse;width:100%}
                .main-table th{border:1px solid black;padding:6px;text-align:center;font-weight:normal}
                .main-table .data-row td{border:1px solid black;padding:6px;text-align:center}
                .main-table .name-column{text-align:left}
                .main-table .signature-row td{border-left:1px solid black;border-right:1px solid black;border-top:none;border-bottom:none;padding:10px}
                .main-table .pengeluaran-title-row td{border:1px solid black;padding:8px;text-align:center}
                .main-table .pengeluaran-content-row td{border-left:1px solid black;border-right:1px solid black;border-top:none;border-bottom:1px solid black;padding:15px}
                .note-kasubbag{margin-top:10px;color:red}
                .document-title{text-align:center;font-weight:bold;text-decoration:underline}
            </style>
            </head>
            <body>${content}</body></html>`;
            const blob = new Blob([wordDoc], {type: 'application/msword'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(link.href);
        }
        function printDocument() {
            window.print();
        }
        function downloadAsPDF() {
            const element = document.getElementById('document-content');
            const opt = {
                margin: 10,
                filename: `Surat_Permintaan_ATK_${BULAN_NAMES[selectedBulan] || 'Bulan'}_${selectedTahun}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().from(element).set(opt).save();
        }
        function showError(msg) {
            const el = document.getElementById('errorMessage');
            if (el) {
                el.textContent = msg;
                el.style.display = msg ? 'block' : 'none';
            }
        }
        // ============================================
        // UI HELPERS
        // ============================================
        function showLoading(show, text = "Memproses...") {
            const overlay = document.getElementById("loadingOverlay");
            overlay.style.display = show ? "flex" : "none";
            document.getElementById("loadingText").textContent = text;
        }
        function showToast(message, type = "info") {
            const container = document.getElementById("toastContainer");
            const colors = {
                success: "var(--primary-dark)",
                error: "var(--accent-dark)",
                info: "var(--primary-light)"
            };
            const textColors = {
                success: "white",
                error: "white",
                info: "var(--primary-dark)"
            };
            const icons = {
                success: "fas fa-check-circle",
                error: "fas fa-times-circle",
                info: "fas fa-info-circle"
            };
            const toastEl = document.createElement("div");
            toastEl.className = `toast align-items-center border-0 toast-${type}`;
            toastEl.setAttribute("role", "alert");
            toastEl.style.background = colors[type];
            toastEl.style.color = textColors[type];
            toastEl.style.minWidth = "300px";
            toastEl.style.borderRadius = "12px";
            const closeClass = type === "info" ? "" : "btn-close-white";
            toastEl.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body d-flex align-items-center">
                        <i class="${icons[type]} me-2"></i>
                        <span>${message}</span>
                    </div>
                    <button type="button" class="btn-close ${closeClass} me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            container.appendChild(toastEl);
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 4000
            });
            toast.show();
            toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());
        }
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener("DOMContentLoaded", async function() {
            await loadDataFromSheets();
            initializeDropdowns();
            initializeFormHandlers();
            initTableScrollHandlers();
            loginModal = new bootstrap.Modal(document.getElementById("loginModal"));
            tarikModal = new bootstrap.Modal(document.getElementById("tarikModal"));
            document.getElementById("loginForm").addEventListener("submit", handleLogin);
            document.getElementById("confirmTarikBtn").addEventListener("click", confirmTarik);
            const currentDate = new Date();
            const currentMonth = String(currentDate.getMonth() + 1).padStart(2, "0");
            document.getElementById("filterBulan").value = currentMonth;
        });
    </script>
</body>
</html>
